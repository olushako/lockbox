services:
  lockbox-backup:
    image: ghcr.io/olushako/lockbox:latest
    container_name: lockbox-backup
    restart: unless-stopped
    
    # Mount Docker socket to access containers and volumes
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    
    # Environment variables
    environment:
      # Required
      - BACKUP_PASSWORD=${BACKUP_PASSWORD}
      - S3_ENDPOINT=${S3_ENDPOINT}
      - S3_ACCESS_KEY=${S3_ACCESS_KEY}
      - S3_SECRET_KEY=${S3_SECRET_KEY}
      
      # Optional - S3 configuration
      - S3_REGION=${S3_REGION:-auto}
      - S3_STORAGE_CLASS=${S3_STORAGE_CLASS:-STANDARD}
      - S3_BUCKET_NAME=${S3_BUCKET_NAME:-lockbox}
      
      # Optional - Backup configuration
      - BACKUP_RETENTION_DAYS=${BACKUP_RETENTION_DAYS:-30}
      - TZ=${TZ:-UTC}
      
      # Optional - Cron schedules
      - CRON_VOLUMES=${CRON_VOLUMES:-0 2 * * *}
      - CRON_PG=${CRON_PG:-15 2 * * *}
      - CRON_REDIS=${CRON_REDIS:-30 2 * * *}
      - CRON_CLEANUP=${CRON_CLEANUP:-45 2 * * *}
    
    # Health check
    healthcheck:
      test: ["CMD", "pgrep", "crond"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 5s
